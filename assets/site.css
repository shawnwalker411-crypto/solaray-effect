// ===== Sola Ray Effect: Stable Nav Binding =====

function toggleNav() {
  const btn = document.getElementById('hamburger-btn');
  const drawer = document.getElementById('nav-drawer');
  const overlay = document.getElementById('nav-overlay');

  if (!btn || !drawer || !overlay) return;

  btn.classList.toggle('open');
  drawer.classList.toggle('open');
  overlay.classList.toggle('show');
}

// Bind handlers in a way that survives bfcache navigation
function initNavBindings() {
  const btn = document.getElementById('hamburger-btn');
  const overlay = document.getElementById('nav-overlay');

  // If this page doesn't have the nav, do nothing
  if (!btn || !overlay) return;

  // Prevent duplicate bindings if init runs multiple times
  if (btn.dataset.bound === '1') return;
  btn.dataset.bound = '1';
  overlay.dataset.bound = '1';

  const onToggle = (e) => {
    // Don't let click fall through to underlying elements
    if (e) e.preventDefault();
    toggleNav();
  };

  // Use click (most reliable) + pointerup (touch friendly)
  btn.addEventListener('click', onToggle, { passive: false });
  btn.addEventListener('pointerup', onToggle, { passive: false });

  overlay.addEventListener('click', onToggle, { passive: false });
  overlay.addEventListener('pointerup', onToggle, { passive: false });
}

// Run on normal load
document.addEventListener('DOMContentLoaded', initNavBindings);

// Run when returning via back/forward cache
window.addEventListener('pageshow', initNavBindings);
